import { Injectable } from '@nestjs/common';
import { IUserRepository } from '../../domain/repositories/user.repository';
import { User } from '../../domain/entities/user.entity';
import * as bcrypt from 'bcryptjs';

@Injectable()
export class RegisterUseCase {
    constructor(private readonly userRepository: IUserRepository) {}

    async execute(email: string, name: string, password: string) {
        const existing = await this.userRepository.findByEmail(email);
        if (existing) throw new Error('User exists');

        const hashed = await bcrypt.hash(password, 10);
        const user = new User(Date.now().toString(), email, name, hashed);
        return this.userRepository.save(user);
    }
}